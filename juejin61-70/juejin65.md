# 暴雨梨花针射击问题详解

## 1. 问题背景

在《斗罗大陆》的世界中，唐门外门弟子唐三发现了一种名为"暴雨梨花针"的暗器技巧。这种暗器可以在一条直线上摧毁所有目标。为了练习这门技巧，唐三设置了多个靶子进行训练。每个靶子都是一条垂直于X轴的线段，我们需要帮助唐三计算最少需要发射多少次暴雨梨花针，才能击中所有靶子。

## 2. 问题定义

### 2.1 输入说明
- `k`：靶子的数量
- `p`：取余的数值
- `target`：靶子数组，每个靶子由三个参数描述 `[x_left, x_right, y]`
  - `x_left`：线段在X轴上的起始位置
  - `x_right`：线段在X轴上的结束位置
  - `y`：线段的固定高度

### 2.2 输出要求
- 返回击中所有靶子所需的最少射击次数，结果需要对 `p` 取余

### 2.3 补充说明
- 暴雨梨花针从某个 `x` 坐标处发射，可以垂直上升到 `y = 100` 高度
- 任何在这条垂直线上的靶子都会被击中

### 2.4 示例
```python
示例1:
输入：k = 4, p = 100
target = [[10, 26, 3], [4, 8, 29], [1, 5, 8], [9, 9, 9]]
输出：3

示例2:
输入：k = 3, p = 100
target = [[10, 26, 3], [4, 8, 29], [1, 5, 8]]
输出：2
```

## 3. 解题思路

### 3.1 问题本质
1. 虽然问题描述中涉及二维平面，但由于暴雨梨花针可以达到 `y = 100` 的高度，所有靶子的高度 `y` 值实际上并不影响结果
2. 我们可以将问题简化为一维区间覆盖问题：用最少的点覆盖所有区间

### 3.2 贪心策略
1. 将所有靶子投影到X轴上，得到一系列区间 `[x_left, x_right]`
2. 按照区间的右端点进行排序
3. 对于每个未被覆盖的区间，在其右端点放置一个暴雨梨花针
4. 这样可以保证：
   - 当前区间被覆盖
   - 可能同时覆盖其他延伸到这个点或更远的区间

### 3.3 算法正确性
这个贪心策略是正确的，因为：
1. 如果我们不在右端点放置暴雨梨花针，而是选择区间内的其他点，覆盖的区间范围只会更小
2. 按右端点排序可以确保我们始终选择能覆盖最多未处理区间的位置

## 4. 代码实现

### 4.1 完整代码
```python
def solution(k, p, target):
    if not target:
        return 0
        
    # 转换为区间并按右端点排序
    intervals = [(t[0], t[1]) for t in target]
    intervals.sort(key=lambda x: x[1])
    
    count = 0
    pos = float('-inf')
    
    # 贪心：在需要时在最右点放置线
    for left, right in intervals:
        if left > pos:
            pos = right
            count += 1
            
    return count % p
```

### 4.2 代码解释
1. **特殊情况处理**：
   - 如果目标数组为空，直接返回0

2. **数据预处理**：
   - 将每个靶子转换为区间 `[x_left, x_right]`
   - 忽略 `y` 值，因为它不影响结果
   - 按区间右端点排序

3. **贪心处理**：
   - `pos` 记录最后一次放置暴雨梨花针的位置
   - 对于每个区间，如果其左端点大于 `pos`，说明当前区间未被覆盖
   - 需要在当前区间右端点放置新的暴雨梨花针
   - 更新 `pos` 和计数器 `count`

4. **结果处理**：
   - 返回射击次数对 `p` 取余的结果

### 4.3 复杂度分析
- 时间复杂度：O(n log n)，主要来自排序操作
- 空间复杂度：O(n)，需要存储区间数组

## 5. 测试验证
```python
if __name__ == "__main__":
    testTarget1 = [
        [10, 26, 3],
        [4, 8, 29],
        [1, 5, 8],
        [9, 9, 9]
    ]
    testTarget2 = [
        [10, 26, 3],
        [4, 8, 29],
        [1, 5, 8]
    ]
    print(solution(4, 100, testTarget1) == 3)  # True
    print(solution(3, 100, testTarget2) == 2)  # True
```

## 6. 注意事项
1. 不要被问题的二维特性迷惑，要学会简化问题
2. 区间覆盖问题通常可以使用贪心策略解决
3. 按右端点排序是解决此类问题的常用技巧
4. 在实现时注要处理边界情况，如空输入

## 7. 扩展思考
1. 如果靶子是任意形状而不是垂直线段，如何解决？
2. 如果暴雨梨花针不是垂直发射，而是可以有一定角度，问题会如何变化？
3. 如果有些靶子的高度超过100，算法需要如何修改？

这些扩展问题可以帮助我们更深入地理解问题本质，培养算法思维。