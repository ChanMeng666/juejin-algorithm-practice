# 基本计算器实现

## 题目描述

实现一个基本的计算器来计算简单的字符串表达式的值。

### 输入规则
- 输入的字符串表达式是有效的，可能包含数字（0-9）、加减乘除运算符（+、-、*、/）和括号()
- 字符串中不包含空格
- 除法运算只保留整数结果
- 不允许使用内置的eval函数

### 示例
```python
输入：expression = "1+1"
输出：2

输入：expression = "3+4*5/(3+2)"
输出：7

输入：expression = "4+2*5-2/1"
输出：12

输入：expression = "(1+(4+5+2)-3)+(6+8)"
输出：23

输入：expression = "2*(5+5*2)/3+(6+8*3)"
输出：40
```

## 解题思路

### 1. 核心思想
这是一个典型的表达式求值问题，可以使用栈来实现。主要需要解决以下几个关键点：
- 运算符优先级处理
- 括号的处理
- 多位数字的处理
- 按正确顺序执行运算

### 2. 具体实现步骤

#### 2.1 数据结构设计
使用两个栈：
- nums栈：用于存储数字
- ops栈：用于存储运算符

#### 2.2 运算符优先级处理
定义优先级函数：
- 乘除（*、/）优先级为2
- 加减（+、-）优先级为1
- 左括号优先级为0

#### 2.3 主要算法流程
1. 遍历表达式字符串，根据不同字符类型进行处理：

   a. 遇到数字：
   - 解析完整的多位数字
   - 将数字压入nums栈

   b. 遇到左括号：
   - 直接压入ops栈

   c. 遇到右括号：
   - 计算括号内的所有表达式直到遇到左括号
   - 弹出左括号

   d. 遇到运算符：
   - 比较当前运算符与ops栈顶运算符的优先级
   - 如果栈顶运算符优先级更高或相等，就进行计算
   - 将当前运算符压入ops栈

2. 表达式遍历完成后，处理ops栈中剩余的运算符

### 3. 代码实现关键点

#### 3.1 基本运算函数
```python
def calculate(num1, num2, operator):
    if operator == '+': return num1 + num2
    elif operator == '-': return num1 - num2
    elif operator == '*': return num1 * num2
    elif operator == '/': return num1 // num2  # 使用整除运算符
```

#### 3.2 优先级判断函数
```python
def precedence(operator):
    if operator in ['+', '-']: return 1
    if operator in ['*', '/']: return 2
    return 0
```

## 注意事项

1. 除法运算使用整除运算符 `//`，确保结果为整数
2. 处理多位数字时需要正确累加每一位
3. 运算符优先级的正确处理很关键
4. 括号的处理需要特别注意匹配
5. 栈的操作顺序要正确，特别是弹出数字进行计算时的顺序

## 复杂度分析

- 时间复杂度：O(n)，其中n是表达式的长度
- 空间复杂度：O(n)，需要两个栈来存储数字和运算符

## 扩展思考

1. 如何处理负数？
2. 如何支持小数运算？
3. 如何处理更多的运算符（如取模、幂运算等）？
4. 如何优化代码使其更加高效？

这道题目是算法面试中的经典题目，理解和掌握它对于提升编程能力很有帮助。通过这个问题，我们不仅可以学习到栈的应用，还能理解表达式解析的基本原理。

